<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>QUIC Retry Offload</title>
<meta content="Martin Duke" name="author">
<meta content="Nick Banks" name="author">
<meta content='
       QUIC uses Retry packets to reduce load on stressed servers, by forcing the
client to prove ownership of its address before the server commits state.
QUIC also has an anti-tampering mechanism to prevent the unauthorized injection
of Retry packets into a connection. However, a server operator may want to
offload production of Retry packets to an anti-Denial-of-Service agent or
hardware accelerator. "Retry Offload" is a mechanism for coordination between
a server and an external generator of Retry packets that can succeed despite
the anti-tampering mechanism. 
    ' name="description">
<meta content="xml2rfc 3.25.0" name="generator">
<meta content="draft-ietf-quic-retry-offload-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.25.0
    Python 3.12.8
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.4
    lxml 5.3.0
    platformdirs 4.3.6
    pycountry 24.6.1
    PyYAML 6.0.2
    requests 2.32.3
    setuptools 70.3.0
    wcwidth 0.2.13
-->
<link href="draft-ietf-quic-retry-offload.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  --font-title: "Sofia Sans Semi Condensed", sans-serif;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
section {
  clear: both;
}
.section-number {
  padding-right: 0.5em;
}
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-title);
  font-weight: 680;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
  vertical-align: top;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
  & :is(ol, ul) {
    margin-left: 1em;
  }
}
li {
  margin: 0 0 0.25em 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
  & li {
    margin-top: 0.5em;
  }
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  margin: 0 0 0 2em;
  & li {
    margin: 0;
    & :first-child { margin-top: 0; }
    & :last-child { margin-bottom: 0; }
  }
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
  &.olPercent {
    --indent: 5ch;
    & > dt {
      min-width: calc(var(--indent) - 2ch);
    }
  }
  &.olPercent > dt {
    float: none;
  }

  dl > dd > & {
    margin-top: 0.5em;
    margin-bottom: 0;
  }
}
dl:not(.dlNewline) > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
  & > :is(:first-child, .break:first-child + *) {
    margin-top: 0;
  }
  & > :is(:last-child) {
    margin-bottom: 0;
  }
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
  caption-side: bottom;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    /* In the horizontal direction, sometimes people make over-sized figures.
       Scrollbars for those is therefore necessary: auto adds them as necessary..
       In the vertical direction, the line-height can combine with the font
       asender/descender height to produce scrollbars: hidden avoids that. */
    overflow: auto hidden;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: auto;
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
  &[href] {
    color: var(--pilcrow-weak);
    &:hover { text-decoration: none; }
  }
}
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
  & dt {
    width: var(--identifier-width);
    min-width: var(--identifier-width);
    clear: left;
    float: left;
    text-align: right;
    margin-right: 1ch;
  }
  & dd {
    margin: 0;
    margin-left: calc(1em + var(--identifier-width)) !important;
    min-width: 5em;
  }
  & .authors {
    & .author {
      display: inline-block;
      margin-right: 1.5em;
    }
    & .org {
      font-style: italic;
    }
  }
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;

  & nav {
    & ul {
      margin: 0 0.5em 0 0;
      padding: 0;
      list-style: none;
    }
    & li {
      line-height: 1.3em;
      margin: 2px 0;
      padding-left: 1.2em;
      text-indent: -1.2em;
    }
  }
  & a.xref {
    white-space: normal;
  }
}

.references {
  & > dt {
    text-align: right;
    font-weight: bold;
    min-width: 10ch;
    margin-right: 1.5ch;
    &:target::before {
      content: "⇒";
      margin: 0 10px 0 -25px;
    }
  }
  & > dd {
    margin-left: 12ch !important;
    overflow: visible;
    & .refInstance {
      margin-bottom: 0.8em;
    }
    & .ascii {
      margin-bottom: 0.25em;
    }
  }
}

#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  max-width: 20em;
  margin: 1em auto 1em 0;

  & .nameRole {
    font-weight: 700;
    margin-left: 0;
  }
  & .label {
    margin: 0.5em 0;
  }
  & .type {
    display: none;
  }
  & .alternative-contact {
    margin: 0.5em 0 0.25em 0;
  }
  & .non-ascii {
    margin: 0 0 0 2em;
  }
  & div.left {
    text-align: left;
  }
  & div.right {
    text-align: right;
  }
}

hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

/* Comments */
.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}

@media screen {
  #toc nav {
    font-family: var(--font-title);
    font-weight: 360;
    & > ul { margin-bottom: 2em; }
    & ul {
      margin: 0 0 0 4px;
      & :is(p, li) {
        margin: 2px 0;
      }
    }
  }
  #toc a.toplink {
    float: right;
  }
}
@media not screen {
  #toc a.toplink {
    display: none;
  }
}


/* TOC layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
    &::before { /* css hamburger */
      float: right;
      position: relative;
      width: 1em;
      height: 1px;
      left: -164px;
      margin: 8px 0 0 0;
      background: white none repeat scroll 0 0;
      box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
      content: "";
    }
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active {
    opacity: 1;
    & nav { display: block; }
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:is(:link, :focus, :hover),
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin: 2px 0.5em 0;
  }
}

/* TOC layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
  #toc a.toplink {
    margin: 8px 0.5em 0;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">QUIC Retry Offload</td>
<td class="right">September 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">Duke &amp; Banks</td>
<td class="center">Expires 12 March 2026</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">QUIC</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-quic-retry-offload-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-09-08" class="published">8 September 2025</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2026-03-12">12 March 2026</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">M. Duke</div>
<div class="org">Google</div>
</div>
<div class="author">
      <div class="author-name">N. Banks</div>
<div class="org">Microsoft</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">QUIC Retry Offload</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">QUIC uses Retry packets to reduce load on stressed servers, by forcing the
client to prove ownership of its address before the server commits state.
QUIC also has an anti-tampering mechanism to prevent the unauthorized injection
of Retry packets into a connection. However, a server operator may want to
offload production of Retry packets to an anti-Denial-of-Service agent or
hardware accelerator. "Retry Offload" is a mechanism for coordination between
a server and an external generator of Retry packets that can succeed despite
the anti-tampering mechanism.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note" id="section-note.1">
      <h2 id="name-note-to-readers">
<a href="#name-note-to-readers" class="section-name selfRef">Note to Readers</a>
      </h2>
<p id="section-note.1-1">Discussion of this document takes place on the
  QUIC Working Group mailing list (quic@ietf.org),
  which is archived at <a href="https://mailarchive.ietf.org/arch/browse/quic/">https://mailarchive.ietf.org/arch/browse/quic/</a>.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Source for this draft and an issue tracker can be found at
  <a href="https://github.com/quicwg/load-balancers">https://github.com/quicwg/load-balancers</a>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 12 March 2026.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="auto internal xref">1.2</a>.  <a href="#name-notation" class="internal xref">Notation</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-common-requirements" class="internal xref">Common Requirements</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="auto internal xref">2.1</a>.  <a href="#name-consistent-treatment-of-ini" class="internal xref">Consistent Treatment of Initials</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="auto internal xref">2.2</a>.  <a href="#name-considerations-for-non-init" class="internal xref">Considerations for Non-Initial Packets</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-no-shared-state-retry-offlo" class="internal xref">No-Shared-State Retry Offload</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-configuration-agent-actions" class="internal xref">Configuration Agent Actions</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-offload-requirements" class="internal xref">Offload Requirements</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="auto internal xref">3.3</a>.  <a href="#name-server-requirements" class="internal xref">Server Requirements</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-shared-state-retry-offload" class="internal xref">Shared-State Retry Offload</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-token-protection-with-aead" class="internal xref">Token Protection with AEAD</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-configuration-agent-actions-2" class="internal xref">Configuration Agent Actions</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-offload-requirements-2" class="internal xref">Offload Requirements</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-server-requirements-2" class="internal xref">Server Requirements</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-shared-state-retry-keys" class="internal xref">Shared-State Retry Keys</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-retry-offload-yang-model" class="internal xref">Retry Offload YANG Model</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#appendix-A.1" class="auto internal xref">A.1</a>.  <a href="#name-tree-diagram" class="internal xref">Tree Diagram</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#appendix-A.2" class="auto internal xref">A.2</a>.  <a href="#name-shared-state-retry-token-te" class="internal xref">Shared State Retry Token Test Vectors</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#appendix-B" class="auto internal xref">Appendix B</a>.  <a href="#name-transition-mode-scenarios" class="internal xref">Transition Mode Scenarios</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#appendix-B.1" class="auto internal xref">B.1</a>.  <a href="#name-handshakes-in-progress" class="internal xref">Handshakes in Progress</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#appendix-B.2" class="auto internal xref">B.2</a>.  <a href="#name-new-connections" class="internal xref">New Connections</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-C" class="auto internal xref">Appendix C</a>.  <a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-D" class="auto internal xref">Appendix D</a>.  <a href="#name-change-log" class="internal xref">Change Log</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#appendix-D.1" class="auto internal xref">D.1</a>.  <a href="#name-since-draft-duke-quic-retry" class="internal xref">since draft-duke-quic-retry-offload-00</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#appendix-D.2" class="auto internal xref">D.2</a>.  <a href="#name-since-draft-ietf-quic-load-" class="internal xref">since draft-ietf-quic-load-balancers-12</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.3">
                <p id="section-toc.1-1.11.2.3.1"><a href="#appendix-D.3" class="auto internal xref">D.3</a>.  <a href="#name-since-draft-ietf-quic-load-b" class="internal xref">since draft-ietf-quic-load-balancers-11</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.4">
                <p id="section-toc.1-1.11.2.4.1"><a href="#appendix-D.4" class="auto internal xref">D.4</a>.  <a href="#name-since-draft-ietf-quic-load-ba" class="internal xref">since draft-ietf-quic-load-balancers-10</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.5">
                <p id="section-toc.1-1.11.2.5.1"><a href="#appendix-D.5" class="auto internal xref">D.5</a>.  <a href="#name-since-draft-ietf-quic-load-bal" class="internal xref">since draft-ietf-quic-load-balancers-09</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.6">
                <p id="section-toc.1-1.11.2.6.1"><a href="#appendix-D.6" class="auto internal xref">D.6</a>.  <a href="#name-since-draft-ietf-quic-load-bala" class="internal xref">since draft-ietf-quic-load-balancers-08</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.7">
                <p id="section-toc.1-1.11.2.7.1"><a href="#appendix-D.7" class="auto internal xref">D.7</a>.  <a href="#name-since-draft-ietf-quic-load-balan" class="internal xref">since draft-ietf-quic-load-balancers-07</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.8">
                <p id="section-toc.1-1.11.2.8.1"><a href="#appendix-D.8" class="auto internal xref">D.8</a>.  <a href="#name-since-draft-ietf-quic-load-balanc" class="internal xref">since draft-ietf-quic-load-balancers-06</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.9">
                <p id="section-toc.1-1.11.2.9.1"><a href="#appendix-D.9" class="auto internal xref">D.9</a>.  <a href="#name-since-draft-ietf-quic-load-balance" class="internal xref">since draft-ietf-quic-load-balancers-05</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.10">
                <p id="section-toc.1-1.11.2.10.1"><a href="#appendix-D.10" class="auto internal xref">D.10</a>. <a href="#name-since-draft-ietf-quic-load-balancer" class="internal xref">since draft-ietf-quic-load-balancers-04</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.11">
                <p id="section-toc.1-1.11.2.11.1"><a href="#appendix-D.11" class="auto internal xref">D.11</a>. <a href="#name-since-draft-ietf-quic-load-balancer-2" class="internal xref">since-draft-ietf-quic-load-balancers-03</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.12">
                <p id="section-toc.1-1.11.2.12.1"><a href="#appendix-D.12" class="auto internal xref">D.12</a>. <a href="#name-since-draft-ietf-quic-load-balancer-3" class="internal xref">since-draft-ietf-quic-load-balancers-02</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.13">
                <p id="section-toc.1-1.11.2.13.1"><a href="#appendix-D.13" class="auto internal xref">D.13</a>. <a href="#name-since-draft-ietf-quic-load-balancer-4" class="internal xref">since-draft-ietf-quic-load-balancers-01</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.14">
                <p id="section-toc.1-1.11.2.14.1"><a href="#appendix-D.14" class="auto internal xref">D.14</a>. <a href="#name-since-draft-ietf-quic-load-balancer-5" class="internal xref">since-draft-ietf-quic-load-balancers-00</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.15">
                <p id="section-toc.1-1.11.2.15.1"><a href="#appendix-D.15" class="auto internal xref">D.15</a>. <a href="#name-since-draft-duke-quic-load-" class="internal xref">Since draft-duke-quic-load-balancers-06</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.16">
                <p id="section-toc.1-1.11.2.16.1"><a href="#appendix-D.16" class="auto internal xref">D.16</a>. <a href="#name-since-draft-duke-quic-load-b" class="internal xref">Since draft-duke-quic-load-balancers-05</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.17">
                <p id="section-toc.1-1.11.2.17.1"><a href="#appendix-D.17" class="auto internal xref">D.17</a>. <a href="#name-since-draft-duke-quic-load-ba" class="internal xref">Since draft-duke-quic-load-balancers-04</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.18">
                <p id="section-toc.1-1.11.2.18.1"><a href="#appendix-D.18" class="auto internal xref">D.18</a>. <a href="#name-since-draft-duke-quic-load-bal" class="internal xref">Since draft-duke-quic-load-balancers-03</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.19">
                <p id="section-toc.1-1.11.2.19.1"><a href="#appendix-D.19" class="auto internal xref">D.19</a>. <a href="#name-since-draft-duke-quic-load-bala" class="internal xref">Since draft-duke-quic-load-balancers-02</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.20">
                <p id="section-toc.1-1.11.2.20.1"><a href="#appendix-D.20" class="auto internal xref">D.20</a>. <a href="#name-since-draft-duke-quic-load-balan" class="internal xref">Since draft-duke-quic-load-balancers-01</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.21">
                <p id="section-toc.1-1.11.2.21.1"><a href="#appendix-D.21" class="auto internal xref">D.21</a>. <a href="#name-since-draft-duke-quic-load-balanc" class="internal xref">Since draft-duke-quic-load-balancers-00</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-E" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">QUIC <span>[<a href="#RFC9000" class="cite xref">RFC9000</a>]</span> servers send Retry packets to avoid prematurely allocating
resources when under stress, such as during a Denial of Service (DoS) attack.
Because both Initial packets and Retry packets have weak authentication
properties, the Retry packet contains an encrypted token that helps the client
and server to validate, via transport parameters, that an attacker did not
inject or modify a packet of either type for this connection attempt.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">However, a server under stress is less inclined to process incoming Initial
packets and compute the Retry token in the first place. An analogous mechanism
for TCP is syncookies <span>[<a href="#RFC4987" class="cite xref">RFC4987</a>]</span>. As TCP has weaker authentication properties
to QUIC, syncookie generation can often be offloaded to a hardware device, or
to a anti-Denial-of-Service provider that is topologically far from the
protected server. As such an offload would behave exactly like an attacker,
QUIC's authentication methods make such a capability impossible.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">This document seeks to enable offloading of Retry generation to QUIC via
explicit coordination between servers and the hardware or provider offload,
which this document refers to as a "Retry Offload." It has two different
modes, to conform to two different use cases.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">The no-shared-state mode has minimal coordination and does not require key
sharing. While operationally easier to configure and manage, it places severe
constraints on the operational profile of the offload. In particular, the
offload must control all ingress to the server and fail closed.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">The shared-state mode removes the operational constraints, but also requires
more sophisticated key management.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">Both modes specify a common format for encoding information in the Retry token,
so that the server can correctly populate the relevant transport parameter
fields.<a href="#section-1-6" class="pilcrow">¶</a></p>
<div id="terminology">
<section id="section-1.1">
        <h3 id="name-terminology">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.1-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD",
"SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be
interpreted as described in RFC 2119 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span>.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">In this document, these words will appear with that interpretation only when in
ALL CAPS.  Lower case uses of these words are not to be interpreted as carrying
significance described in RFC 2119.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<p id="section-1.1-3">For brevity, "Connection ID" will often be abbreviated as "CID".<a href="#section-1.1-3" class="pilcrow">¶</a></p>
<p id="section-1.1-4">A "Retry Offload" is a hardware or software device that is conceptually separate
from a QUIC server that terminates QUIC connections. This document assumes that
the Retry Offload and the server have an administrative relationship that allows
them to accept common configuation.<a href="#section-1.1-4" class="pilcrow">¶</a></p>
<p id="section-1.1-5">A "configuration agent" is some entity that determines the common configuration
to be distributed to the servers and the Retry Offload.<a href="#section-1.1-5" class="pilcrow">¶</a></p>
<p id="section-1.1-6">This document uses "QUIC" to refer to the protocol in QUIC version 1
<span>[<a href="#RFC9000" class="cite xref">RFC9000</a>]</span>. Retry offloads can be applied to other versions of QUIC that use
Retry packets and have identical information requirements for Retry validation.
However, note that source and destination connection IDs are the only relevant
data fields that are invariant across QUIC versions <span>[<a href="#RFC8999" class="cite xref">RFC8999</a>]</span>.<a href="#section-1.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="notation">
<section id="section-1.2">
        <h3 id="name-notation">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-notation" class="section-name selfRef">Notation</a>
        </h3>
<p id="section-1.2-1">All wire formats will be depicted using the notation defined in Section 1.3 of
<span>[<a href="#RFC9000" class="cite xref">RFC9000</a>]</span>.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<p id="section-1.2-2">The example below illustrates the basic framework:<a href="#section-1.2-2" class="pilcrow">¶</a></p>
<span id="name-example-format"></span><div id="fig-ex-format">
<figure id="figure-1">
          <div class="alignLeft art-text artwork" id="section-1.2-3.1">
<pre>
Example Structure {
  One-bit Field (1),
  7-bit Field with Fixed Value (7) = 61,
  Field with Variable-Length Integer (i),
  Arbitrary-Length Field (..),
  Variable-Length Field (8..24),
  Field With Minimum Length (16..),
  Field With Maximum Length (..128),
  [Optional Field (64)],
  Repeated Field (8) ...,
}
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-example-format" class="selfRef">Example Format</a>
          </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<div id="common-requirements">
<section id="section-2">
      <h2 id="name-common-requirements">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-common-requirements" class="section-name selfRef">Common Requirements</a>
      </h2>
<p id="section-2-1">Regardless of mechanism, a Retry Offload has an active mode, where it is
generating Retry packets, and an inactive mode, where it is not, based on its
assessment of server load and the likelihood an attack is underway. The choice
of mode MAY be made on a per-packet or per-connection basis, through a
stochastic process or based on client address.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">A configuration agent MUST distribute a list of QUIC versions the Retry Offload
supports. It MAY also distribute either an "Allow-List" or a "Deny-List" of
other QUIC versions. It MUST NOT distribute both an Allow-List and a Deny-List.<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">The Allow-List or Deny-List MUST NOT include any versions included for Retry
Offload support.<a href="#section-2-3" class="pilcrow">¶</a></p>
<p id="section-2-4">The Configuration Agent MUST provide a means for the entity that controls the
Retry Offload to report its supported version(s) to the configuration Agent. If
the entity has not reported this information, it MUST NOT activate the Retry
Offload and the configuration agent MUST NOT distribute configuration that
activates it.<a href="#section-2-4" class="pilcrow">¶</a></p>
<p id="section-2-5">The configuration agent MAY delete versions from the final supported version
list if policy does not require the Retry Offload to operate on those versions.<a href="#section-2-5" class="pilcrow">¶</a></p>
<p id="section-2-6">The configuration Agent MUST provide a means for the entities that control
servers behind the Retry Offload to report either an Allow-List or a Deny-List.<a href="#section-2-6" class="pilcrow">¶</a></p>
<p id="section-2-7">If all entities supply Allow-Lists, the consolidated list MUST be the union of
these sets. If all entities supply Deny-Lists, the consolidated list MUST be
the intersection of these sets.<a href="#section-2-7" class="pilcrow">¶</a></p>
<p id="section-2-8">If entities provide a mixture of Allow-Lists and Deny-Lists, the consolidated
list MUST be a Deny-List that is the intersection of all provided Deny-Lists and
the inverses of all Allow-Lists.<a href="#section-2-8" class="pilcrow">¶</a></p>
<p id="section-2-9">If no entities that control servers have reported Allow-Lists or Deny-Lists,
the default is a Deny-List with the null set (i.e., all unsupported versions
will be admitted). This preserves the future extensibilty of QUIC.<a href="#section-2-9" class="pilcrow">¶</a></p>
<p id="section-2-10">A Retry Offload MUST forward all packets for a QUIC version it does not
support that are not on a Deny-List or absent from an Allow-List. Note that if
servers support versions the Retry Offload does not, this may increase load on
the servers.<a href="#section-2-10" class="pilcrow">¶</a></p>
<p id="section-2-11">Note that future versions of QUIC might not have Retry packets, require
different information in Retry, or use different packet type indicators.<a href="#section-2-11" class="pilcrow">¶</a></p>
<div id="consistent-treatment-of-initials">
<section id="section-2.1">
        <h3 id="name-consistent-treatment-of-ini">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-consistent-treatment-of-ini" class="section-name selfRef">Consistent Treatment of Initials</a>
        </h3>
<p id="section-2.1-1">Retry Offloads SHOULD treat Initial packets from the same connection with a
uniform policy. Initial packets of the first and second client flight can be
difficult to distinguish without expensive decryption of the contents, which is
unsuitable under the conditions of a DDoS attack. If the first packet of a
connection is admitted without Retry, but the second triggers a Retry, that
Retry packet will be ignored and the loss of an Initial coalesced with other
packets can impair performance. In some situations, the client does not yet have
handshake keys, and dropping further client Initial packets creates a deadlock
where the connection cannot progress.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2">The simplest means to ensure this is to require, when active, a Retry Token
for all incoming Initial packets, and send a Retry packet otherwise. If the
Retry Offload is to be more selective, one technique keeps state on which
address/port 4-tuples have been admitted. Another would be to apply a secure
hash to the source IP address, port, and connection ID to deterministically
compute whether the Initial requires a Retry Token or not. These source
values remain consistent over the handshake.<a href="#section-2.1-2" class="pilcrow">¶</a></p>
<p id="section-2.1-3">However, even with these techniques there is a potential problem when a Retry
Offload switches from inactive to active mode. The Retry Offload could admit
the first packet while in inactive mode, and then drop subsequent Initials in
active mode.<a href="#section-2.1-3" class="pilcrow">¶</a></p>
<p id="section-2.1-4">If the Retry Offload is always on-path, it MAY keep state on incoming
connections while in inactive mode to avoid this problem. If it cannot or will
not keep such state, it SHOULD implement "transition mode" for an interval
chosen to include the likely Initial packet exchange of most clients (200ms is a
sensible default).<a href="#section-2.1-4" class="pilcrow">¶</a></p>
<p id="section-2.1-5">In transition mode, Retry Offloads process Initial packets with Retry tokens
as in active mode. When the Retry Offload receives an Initial packet with no
token, it issues a Retry AND forwards the packet to the server. If the client
has already received a packet from the server, it will ignore the Retry and the
connection will progress normally. If not, the client will reconnect based on
the Retry, the server's response to the first initial will be discarded, and
the connection will progress normally based on the client's second Initial.
<a href="#mid-handshake" class="auto internal xref">Appendix B</a> explores the various possible packet sequences in
transition mode.<a href="#section-2.1-5" class="pilcrow">¶</a></p>
<p id="section-2.1-6">Note that transition mode provides no actual DDoS relief to the server, so its
duration should be as short as possible. The Retry Offload can choose not to
implement transition mode and cause some client connections to fail.<a href="#section-2.1-6" class="pilcrow">¶</a></p>
<p id="section-2.1-7">Servers operating behind a Retry Offload SHOULD implement a mechanism that
operates whenever a client Initial arrives with a valid Retry token. If there
is another connection with identical client Connection ID, IP, and Port, but
with an unvalidated address, that connection is immediately and silently
terminated. This mechanism eliminates incorrect connection state that is an
artifact of transition mode, as explained in <a href="#mid-handshake" class="auto internal xref">Appendix B</a>.<a href="#section-2.1-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="considerations-for-non-initial-packets">
<section id="section-2.2">
        <h3 id="name-considerations-for-non-init">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-considerations-for-non-init" class="section-name selfRef">Considerations for Non-Initial Packets</a>
        </h3>
<p id="section-2.2-1">Initial Packets are especially effective at consuming server resources
because they cause the server to create connection state. Even when mitigating
this load with Retry Packets, the act of validating an Initial Token and sending
a Retry Packet is more expensive than the response to a non-Initial packet with
an unknown Connection ID: simply dropping it and/or sending a Stateless Reset.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2-2">Nevertheless, a Retry Offload in Active Mode might desire to shield servers
from non-Initial packets that do not correspond to a previously admitted
Initial Packet. This has a number of considerations.<a href="#section-2.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2-3.1">
            <p id="section-2.2-3.1.1">If a Retry Offload maintains no per-flow state, it cannot distinguish between
valid and invalid non-Initial packets and MUST forward all non-Initial Packets
to the server.<a href="#section-2.2-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.2-3.2">
            <p id="section-2.2-3.2.1">For QUIC versions the Retry Offload does not support and are present on the
Allow-List (or absent from the Deny-List), the Retry Offload cannot distinguish
Initial Packets from other long headers and therefore MUST admit all long
headers.<a href="#section-2.2-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.2-3.3">
            <p id="section-2.2-3.3.1">If a Retry Offload keeps per-flow state, it can identify 4-tuples that have
been previously approved, admit non-Initial packets from those flows, and
drop all others. However, dropping short headers will effectively break Address
Migration and NAT Rebinding when in Active Mode, as post-migration packets will
arrive with a previously unknown 4-tuple. This policy will also break connection
attempts using any new QUIC versions that begin connections with a short header.<a href="#section-2.2-3.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.2-3.4">
            <p id="section-2.2-3.4.1">If a Retry Offload is integrated with a QUIC-LB routable load balancer
<span>[<a href="#I-D.ietf-quic-load-balancers" class="cite xref">I-D.ietf-quic-load-balancers</a>]</span>, it can verify that the Destination Connection
ID is routable, and only admit non-Initial packets with routable DCIDs. As the
Connection ID encoding is invariant across QUIC versions, the Retry Offload can
do this for all short headers.<a href="#section-2.2-3.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-2.2-4">Nothing in this section prevents Retry Offloads from making basic syntax
correctness checks on packets with QUIC versions that it understands (e.g.,
enforcing the Initial Packet datagram size minimum in version 1).<a href="#section-2.2-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="no-shared-state-retry-offload">
<section id="section-3">
      <h2 id="name-no-shared-state-retry-offlo">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-no-shared-state-retry-offlo" class="section-name selfRef">No-Shared-State Retry Offload</a>
      </h2>
<p id="section-3-1">The no-shared-state Retry Offload requires no coordination, except that the
server must be configured to accept this offload and know which QUIC versions
the Retry Offload supports. The scheme uses the first bit of the token to
distinguish between tokens from Retry packets (codepoint '0') and tokens from
NEW_TOKEN frames (codepoint '1').<a href="#section-3-1" class="pilcrow">¶</a></p>
<div id="configuration-agent-actions">
<section id="section-3.1">
        <h3 id="name-configuration-agent-actions">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-configuration-agent-actions" class="section-name selfRef">Configuration Agent Actions</a>
        </h3>
<p id="section-3.1-1">See <a href="#common-requirements" class="auto internal xref">Section 2</a>.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="nss-offload-requirements">
<section id="section-3.2">
        <h3 id="name-offload-requirements">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-offload-requirements" class="section-name selfRef">Offload Requirements</a>
        </h3>
<p id="section-3.2-1">A no-shared-state Retry Offload MUST be present on all paths from potential
clients to the server. These paths MUST fail to pass QUIC traffic should the
offload fail for any reason. That is, if the offload is not operational, the
server MUST NOT be exposed to client traffic. Otherwise, servers that have
already disabled their Retry capability would be vulnerable to attack.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">The path between offload and server MUST be free of any potential attackers.
Note that this and other requirements above severely restrict the operational
conditions in which a no-shared-state Retry Offload can safely operate.<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<p id="section-3.2-3">Retry tokens generated by the offload MUST have the format below.<a href="#section-3.2-3" class="pilcrow">¶</a></p>
<span id="name-format-of-non-shared-state-"></span><div id="nss-retry-offload-token-format">
<figure id="figure-2">
          <div class="alignLeft art-text artwork" id="section-3.2-4.1">
<pre>
No-Shared-State Retry Offload Token {
  Token Type (1) = 0,
  ODCIL (7) = 8..20,
  Original Destination Connection ID (64..160),
  Opaque Data (..),
}
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-format-of-non-shared-state-" class="selfRef">Format of non-shared-state Retry Offload tokens</a>
          </figcaption></figure>
</div>
<p id="section-3.2-5">The first bit of retry tokens generated by the offload MUST be zero. The token
has the following additional fields:<a href="#section-3.2-5" class="pilcrow">¶</a></p>
<p id="section-3.2-6">ODCIL: The length of the original destination connection ID from the triggering
Initial packet. This is in cleartext to be readable for the server, but
authenticated later in the token. The Retry Offload SHOULD reject any token
in which the value is less than 8.<a href="#section-3.2-6" class="pilcrow">¶</a></p>
<p id="section-3.2-7">Original Destination Connection ID: This also in cleartext and authenticated
later.<a href="#section-3.2-7" class="pilcrow">¶</a></p>
<p id="section-3.2-8">Opaque Data: This data contains the information necessary to authenticate the
Retry token in accordance with the QUIC specification. A straightforward
implementation would encode the Retry Source Connection ID, client IP address,
and a timestamp in the Opaque Data. A more space-efficient implementation would
use the Retry Source Connection ID and Client IP as associated data in an
encryption operation, and encode only the timestamp and the authentication tag
in the Opaque Data. If the Initial packet alters the Connection ID or source IP
address, authentication of the token will fail.<a href="#section-3.2-8" class="pilcrow">¶</a></p>
<p id="section-3.2-9">Upon receipt of an Initial packet with a token that begins with '0', the Retry
Offload MUST validate the token in accordance with the QUIC specification.<a href="#section-3.2-9" class="pilcrow">¶</a></p>
<p id="section-3.2-10">In active mode, the offload MUST issue Retry packets for all client Initial
packets that contain no token, or a token that has the first bit set to '1'. It
MUST NOT forward the packet to the server. The offload MUST validate all tokens
with the first bit set to '0'. If successful, the offload MUST forward the
packet with the token intact. If unsuccessful, it MUST drop the packet. The
Retry Offload MAY send an Initial Packet containing a CONNECTION_CLOSE frame
with the INVALID_TOKEN error code when dropping the packet.<a href="#section-3.2-10" class="pilcrow">¶</a></p>
<p id="section-3.2-11">Note that this scheme has a performance drawback. When the Retry Offload is in
active mode, clients with a token from a NEW_TOKEN frame will suffer a 1-RTT
penalty even though its token provides proof of address.<a href="#section-3.2-11" class="pilcrow">¶</a></p>
<p id="section-3.2-12">In inactive mode, the offload MUST forward all packets that have no token or a
token with the first bit set to '1'. It MUST validate all tokens with the first
bit set to '0'. If successful, the offload MUST forward the packet with the
token intact. If unsuccessful, it MUST drop the packet.<a href="#section-3.2-12" class="pilcrow">¶</a></p>
</section>
</div>
<div id="server-requirements">
<section id="section-3.3">
        <h3 id="name-server-requirements">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-server-requirements" class="section-name selfRef">Server Requirements</a>
        </h3>
<p id="section-3.3-1">A server behind a non-shared-state Retry Offload MUST NOT send Retry packets
for a QUIC version the Retry Offload understands. It MAY send Retry for QUIC
versions the Retry Offload does not understand.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<p id="section-3.3-2">Tokens sent in NEW_TOKEN frames MUST have the first bit set to '1'.<a href="#section-3.3-2" class="pilcrow">¶</a></p>
<p id="section-3.3-3">If a server receives an Initial Packet with the first bit in the token set to
'1', it could be from a server-generated NEW_TOKEN frame and should be processed
in accordance with the QUIC specification. If a server receives an Initial
Packet with the first bit to '0', it is a Retry token and the server MUST NOT
attempt to validate it. Instead, it MUST assume the address is validated, MUST
include the packet's Destination Connection ID in a Retry Source Connection ID
transport parameter, and MUST extract the Original Destination Connection ID
from the token cleartext for use in the transport parameter of the same name.<a href="#section-3.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="shared-state-retry">
<section id="section-4">
      <h2 id="name-shared-state-retry-offload">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-shared-state-retry-offload" class="section-name selfRef">Shared-State Retry Offload</a>
      </h2>
<p id="section-4-1">A shared-state Retry Offload uses a shared key, so that the server can decode
the offload's retry tokens. It does not require that all traffic pass through
the Retry Offload, so servers MAY send Retry packets in response to Initial
packets without a valid token.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">Both server and offload MUST have time synchronized within two seconds of each
other to prevent tokens being incorrectly marked as expired.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">The tokens are protected using AES128-GCM AEAD, as explained in
<a href="#token-protection-with-aead" class="auto internal xref">Section 4.1</a>. All tokens, generated by either the server or
Retry Offload, MUST use the following format, which includes:<a href="#section-4-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-4.1">
          <p id="section-4-4.1.1">A 1 bit token type identifier.<a href="#section-4-4.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-4.2">
          <p id="section-4-4.2.1">A 7 bit token key identifier.<a href="#section-4-4.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-4.3">
          <p id="section-4-4.3.1">A 96 bit unique token number transmitted in clear text, but protected as part
of the AEAD associated data.<a href="#section-4-4.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-4.4">
          <p id="section-4-4.4.1">A token body, encoding the Original Destination Connection ID and the
Timestamp, optionally followed by server specific Opaque Data.<a href="#section-4-4.4.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-4-5">The token protection uses an 128 bit representation of the source IP address
from the triggering Initial packet.  The client IP address is 16 octets. If an
IPv4 address, the last 12 octets are zeroes. It also uses the Source Connection
ID of the Retry packet, which will cause an authentication failure if it
differs from the Destination Connection ID of the packet bearing the token.<a href="#section-4-5" class="pilcrow">¶</a></p>
<p id="section-4-6">If there is a Network Address Translator (NAT) in the server infrastructure that
changes the client IP, the Retry Offload MUST either be positioned behind the
NAT, or the NAT must have the token key to rewrite the Retry token accordingly.
Note also that a host that obtains a token through a NAT and then attempts to
connect over a path that does not have an identically configured NAT will fail
address validation.<a href="#section-4-6" class="pilcrow">¶</a></p>
<p id="section-4-7">The 96 bit unique token number is set to a random value using a
cryptography-grade random number generator.<a href="#section-4-7" class="pilcrow">¶</a></p>
<p id="section-4-8">The token key identifier and the corresponding AEAD key and AEAD IV are
provisioned by the configuration agent.<a href="#section-4-8" class="pilcrow">¶</a></p>
<p id="section-4-9">The token body is encoded as follows:<a href="#section-4-9" class="pilcrow">¶</a></p>
<span id="name-body-of-shared-state-retry-"></span><div id="ss-retry-offload-token-body">
<figure id="figure-3">
        <div class="alignLeft art-text artwork" id="section-4-10.1">
<pre>
Shared-State Retry Offload Token Body {
   Timestamp (64),
   [ODCIL (8) = 8..20],
   [Original Destination Connection ID (64..160)],
   [Port (16)],
   Opaque Data (..),
}
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-body-of-shared-state-retry-" class="selfRef">Body of shared-state Retry Offload tokens</a>
        </figcaption></figure>
</div>
<p id="section-4-11">The token body has the following fields:<a href="#section-4-11" class="pilcrow">¶</a></p>
<p id="section-4-12">Timestamp: The Timestamp is a 64-bit integer, in network order, that expresses
the expiration time of the token as a number of seconds in POSIX time (see Sec.
4.16 of <span>[<a href="#TIME_T" class="cite xref">TIME_T</a>]</span>).<a href="#section-4-12" class="pilcrow">¶</a></p>
<p id="section-4-13">ODCIL: The original destination connection ID length. Tokens in NEW_TOKEN frames
do not have this field.<a href="#section-4-13" class="pilcrow">¶</a></p>
<p id="section-4-14">Original Destination Connection ID: The server or Retry Offload copies this
from the field in the client Initial packet. Tokens in NEW_TOKEN frames do not
have this field.<a href="#section-4-14" class="pilcrow">¶</a></p>
<p id="section-4-15">Port: The Source Port of the UDP datagram that triggered the Retry packet.
This field MUST be present if and only if the ODCIL is greater than zero. This
field is therefore always absent in tokens in NEW_TOKEN frames.<a href="#section-4-15" class="pilcrow">¶</a></p>
<p id="section-4-16">Opaque Data: The server may use this field to encode additional information,
such as congestion window, RTT, or MTU. The Retry Offload MUST have zero-length
opaque data.<a href="#section-4-16" class="pilcrow">¶</a></p>
<p id="section-4-17">Some implementations of QUIC encode in the token the Initial Packet Number used
by the client, in order to verify that the client sends the retried Initial
with a PN larger that the triggering Initial. Such implementations will encode
the Initial Packet Number as part of the opaque data. As tokens may be
generated by the Service, servers MUST NOT reject tokens because they lack
opaque data and therefore the packet number.<a href="#section-4-17" class="pilcrow">¶</a></p>
<p id="section-4-18">Shared-state Retry Offloads use the AES-128-ECB cipher. Future standards could
add new algorithms that use other ciphers to provide cryptographic agility in
accordance with <span>[<a href="#RFC7696" class="cite xref">RFC7696</a>]</span>. Retry Offload and server implementations SHOULD be
extensible to support new algorithms.<a href="#section-4-18" class="pilcrow">¶</a></p>
<div id="token-protection-with-aead">
<section id="section-4.1">
        <h3 id="name-token-protection-with-aead">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-token-protection-with-aead" class="section-name selfRef">Token Protection with AEAD</a>
        </h3>
<p id="section-4.1-1">On the wire, the token is presented as:<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<span id="name-wire-image-of-shared-state-"></span><div id="ss-retry-offload-token-wire-image">
<figure id="figure-4">
          <div class="alignLeft art-text artwork" id="section-4.1-2.1">
<pre>
Shared-State Retry Offload Token {
  Token Type (1),
  Key Sequence (7),
  Unique Token Number (96),
  Encrypted Shared-State Retry Offload Token Body (64..),
  AEAD Integrity Check Value (128),
}
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-wire-image-of-shared-state-" class="selfRef">Wire image of shared-state Retry Offload tokens</a>
          </figcaption></figure>
</div>
<p id="section-4.1-3">The tokens are protected using AES128-GCM as follows:<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-4.1">
            <p id="section-4.1-4.1.1">The Key Sequence is the 7 bit identifier to retrieve the token key and IV.<a href="#section-4.1-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-4.2">
            <p id="section-4.1-4.2.1">The AEAD IV, is 96 bits generated by the configuration agent.<a href="#section-4.1-4.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-4.3">
            <p id="section-4.1-4.3.1">The AEAD nonce, N, is formed by XORing the AEAD IV with the 96 bit unique
token number.<a href="#section-4.1-4.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-4.4">
            <p id="section-4.1-4.4.1">The associated data is a formatted as a pseudo header by combining the
cleartext part of the token with the IP address of the client. The format of
the pseudoheader depends on whether the Token Type bit is '1' (a NEW_TOKEN
token) or '0' (a Retry token).<a href="#section-4.1-4.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<span id="name-psuedoheader-for-shared-sta"></span><div id="ss-retry-offload-token-pseudoheader">
<figure id="figure-5">
          <div class="alignLeft art-text artwork" id="section-4.1-5.1">
<pre>
Shared-State Retry Offload Token Pseudoheader {
  IP Address (128),
  Token Type (1),
  Key Sequence (7),
  Unique Token Number (96),
  [RSCIL (8)],
  [Retry Source Connection ID (0..20)],
}
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-psuedoheader-for-shared-sta" class="selfRef">Psuedoheader for shared-state Retry Offload tokens</a>
          </figcaption></figure>
</div>
<p id="section-4.1-6">RSCIL: The Retry Source Connection ID Length in octets. This field is only
present when the Token Type is '0'.<a href="#section-4.1-6" class="pilcrow">¶</a></p>
<p id="section-4.1-7">Retry Source Connection ID: To create a Retry Token, populate this field with
the Source Connection ID the Retry packet will use. To validate a Retry token,
populate it with the Destination Connection ID of the Initial packet that
carries the token. This field is only present when the Token Type is '0'.<a href="#section-4.1-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-8.1">
            <p id="section-4.1-8.1.1">The input plaintext for the AEAD is the token body. The output ciphertext of
the AEAD is transmitted in place of the token body.<a href="#section-4.1-8.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-8.2">
            <p id="section-4.1-8.2.1">The AEAD Integrity Check Value(ICV), defined in Section 6 of <span>[<a href="#RFC4106" class="cite xref">RFC4106</a>]</span>, is
computed as part of the AEAD encryption process, and is verified during
decryption.<a href="#section-4.1-8.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="configuration-agent-actions-1">
<section id="section-4.2">
        <h3 id="name-configuration-agent-actions-2">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-configuration-agent-actions-2" class="section-name selfRef">Configuration Agent Actions</a>
        </h3>
<p id="section-4.2-1">The configuration agent generates and distributes a "token key", a "token IV",
a key sequence, and the information described in <a href="#common-requirements" class="auto internal xref">Section 2</a>.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ss-offload">
<section id="section-4.3">
        <h3 id="name-offload-requirements-2">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-offload-requirements-2" class="section-name selfRef">Offload Requirements</a>
        </h3>
<p id="section-4.3-1">In inactive mode, the Retry Offload forwards all packets without further
inspection or processing. The rest of this section only applies to a offload in
active mode.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">Retry Offloads MUST NOT issue Retry packets except where explicitly allowed
below, to avoid sending a Retry packet in response to a Retry token.<a href="#section-4.3-2" class="pilcrow">¶</a></p>
<p id="section-4.3-3">The offload MUST generate Retry tokens with the format described above when it
receives a client Initial packet with no token.<a href="#section-4.3-3" class="pilcrow">¶</a></p>
<p id="section-4.3-4">If there is a token of either type, the offload MUST attempt to decrypt it.<a href="#section-4.3-4" class="pilcrow">¶</a></p>
<p id="section-4.3-5">To decrypt a packet, the offload checks the Token Type and constructs a
pseudoheader with the appropriate format for that type, using the bearing
packet's Destination Connection ID to populate the Retry Source Connection ID
field, if any.<a href="#section-4.3-5" class="pilcrow">¶</a></p>
<p id="section-4.3-6">A token is invalid if:<a href="#section-4.3-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3-7.1">
            <p id="section-4.3-7.1.1">it uses an unknown key sequence,<a href="#section-4.3-7.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-7.2">
            <p id="section-4.3-7.2.1">the AEAD ICV does not match the expected value (By construction, it will only
match if the client IP Address, and any Retry Source Connection ID, also
matches),<a href="#section-4.3-7.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-7.3">
            <p id="section-4.3-7.3.1">the ODCIL, if present, is invalid for a client-generated CID (less than 8 or
more than 20 in QUIC version 1),<a href="#section-4.3-7.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-7.4">
            <p id="section-4.3-7.4.1">the Timestamp of a token points to time in the past (however, in order to
allow for clock skew, it SHOULD NOT consider tokens to be expired if the
Timestamp encodes less than two seconds in the past), or<a href="#section-4.3-7.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-7.5">
            <p id="section-4.3-7.5.1">the port number, if present, does not match the source port in the
encapsulating UDP header.<a href="#section-4.3-7.5.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.3-8">Packets with valid tokens MUST be forwarded to the server.<a href="#section-4.3-8" class="pilcrow">¶</a></p>
<p id="section-4.3-9">The offload MUST drop packets with invalid tokens. If the token is of type '1'
(NEW_TOKEN), it MUST respond with a Retry packet. If of type '0', it MUST NOT
respond with a Retry packet.<a href="#section-4.3-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="server-requirements-1">
<section id="section-4.4">
        <h3 id="name-server-requirements-2">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-server-requirements-2" class="section-name selfRef">Server Requirements</a>
        </h3>
<p id="section-4.4-1">The server MAY issue Retry or NEW_TOKEN tokens in accordance with <span>[<a href="#RFC9000" class="cite xref">RFC9000</a>]</span>.
When doing so, it MUST follow the format above.<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<p id="section-4.4-2">The server MUST validate all tokens that arrive in Initial packets, as they may
have bypassed the Retry Offload. It determines validity using the procedure
in <a href="#ss-offload" class="auto internal xref">Section 4.3</a>.<a href="#section-4.4-2" class="pilcrow">¶</a></p>
<p id="section-4.4-3">If a valid Retry token, the server populates the
original_destination_connection_id transport parameter using the
corresponding token field. It populates the retry_source_connection_id transport
parameter with the Destination Connection ID of the packet bearing the token.<a href="#section-4.4-3" class="pilcrow">¶</a></p>
<p id="section-4.4-4">In all other respects, the server processes both valid and invalid tokens in
accordance with <span>[<a href="#RFC9000" class="cite xref">RFC9000</a>]</span>.<a href="#section-4.4-4" class="pilcrow">¶</a></p>
<p id="section-4.4-5">For QUIC versions the offload does not support, the server MAY use any token
format.<a href="#section-4.4-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-5">
      <h2 id="name-security-considerations">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<div id="shared-state-retry-keys">
<section id="section-5.1">
        <h3 id="name-shared-state-retry-keys">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-shared-state-retry-keys" class="section-name selfRef">Shared-State Retry Keys</a>
        </h3>
<p id="section-5.1-1">The Shared-State Retry Offload defined in <a href="#shared-state-retry" class="auto internal xref">Section 4</a> describes the
format of retry tokens or new tokens protected and encrypted using AES128-GCM.
Each token includes a 96 bit randomly generated unique token number, and an 8
bit identifier used to get the AES-GCM encryption context. The AES-GCM
encryption context contains a 128 bit key and an AEAD IV. There are three
important security considerations for these tokens:<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-2.1">
            <p id="section-5.1-2.1.1">An attacker that obtains a copy of the encryption key will be able to decrypt
and forge tokens.<a href="#section-5.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-2.2">
            <p id="section-5.1-2.2.1">Attackers may be able to retrieve the key if they capture a sufficently large
number of retry tokens encrypted with a given key.<a href="#section-5.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-2.3">
            <p id="section-5.1-2.3.1">Confidentiality of the token data will fail if separate tokens reuse the
same 96 bit unique token number and the same key.<a href="#section-5.1-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.1-3">To protect against disclosure of keys to attackers, offload and servers MUST
ensure that the keys are stored securely. To limit the consequences of potential
exposures, the lifetime of any given key should be limited.<a href="#section-5.1-3" class="pilcrow">¶</a></p>
<p id="section-5.1-4">Section 6.6 of <span>[<a href="#RFC9001" class="cite xref">RFC9001</a>]</span> states that "Endpoints MUST count the number of
encrypted packets for each set of keys. If the total number of encrypted packets
with the same key exceeds the confidentiality limit for the selected AEAD, the
endpoint MUST stop using those keys." It goes on with the specific limit: "For
AEAD_AES_128_GCM and AEAD_AES_256_GCM, the confidentiality limit is 2^23
encrypted packets; see Appendix B.1." It is prudent to adopt the same limit
here, and configure the offload in such a way that no more than 2^23 tokens are
generated with the same key.<a href="#section-5.1-4" class="pilcrow">¶</a></p>
<p id="section-5.1-5">In order to protect against collisions, the 96 bit unique token numbers should
be generated using a cryptographically secure pseudorandom number generator
(CSPRNG), as specified in Appendix C.1 of the TLS 1.3 specification
<span>[<a href="#RFC8446" class="cite xref">RFC8446</a>]</span>. With proper random numbers, if fewer than 2^40 tokens are
generated with a single key, the risk of collisions is lower than 0.001%.<a href="#section-5.1-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-6">
      <h2 id="name-iana-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-6-1">There are no IANA requirements.<a href="#section-6-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-combined-references">
<section id="section-7">
      <h2 id="name-references">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-7.1">
        <h3 id="name-normative-references">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC8446">[RFC8446]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8446">https://www.rfc-editor.org/rfc/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9000">[RFC9000]</dt>
        <dd>
<span class="refAuthor">Iyengar, J., Ed.</span> and <span class="refAuthor">M. Thomson, Ed.</span>, <span class="refTitle">"QUIC: A UDP-Based Multiplexed and Secure Transport"</span>, <span class="seriesInfo">RFC 9000</span>, <span class="seriesInfo">DOI 10.17487/RFC9000</span>, <time datetime="2021-05" class="refDate">May 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9000">https://www.rfc-editor.org/rfc/rfc9000</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="TIME_T">[TIME_T]</dt>
      <dd>
<span class="refTitle">"Open Group Standard: Vol. 1: Base Definitions, Issue 7"</span>, <span class="seriesInfo">IEEE Std 1003.1 </span>, <time datetime="2018" class="refDate">2018</time>, <span>&lt;<a href="http://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap04.html#tag_04_16">http://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap04.html#tag_04_16</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-7.2">
        <h3 id="name-informative-references">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-quic-load-balancers">[I-D.ietf-quic-load-balancers]</dt>
        <dd>
<span class="refAuthor">Duke, M.</span>, <span class="refAuthor">Banks, N.</span>, and <span class="refAuthor">C. Huitema</span>, <span class="refTitle">"QUIC-LB: Generating Routable QUIC Connection IDs"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-quic-load-balancers-21</span>, <time datetime="2025-08-27" class="refDate">27 August 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-quic-load-balancers-21">https://datatracker.ietf.org/doc/html/draft-ietf-quic-load-balancers-21</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4106">[RFC4106]</dt>
        <dd>
<span class="refAuthor">Viega, J.</span> and <span class="refAuthor">D. McGrew</span>, <span class="refTitle">"The Use of Galois/Counter Mode (GCM) in IPsec Encapsulating Security Payload (ESP)"</span>, <span class="seriesInfo">RFC 4106</span>, <span class="seriesInfo">DOI 10.17487/RFC4106</span>, <time datetime="2005-06" class="refDate">June 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc4106">https://www.rfc-editor.org/rfc/rfc4106</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4987">[RFC4987]</dt>
        <dd>
<span class="refAuthor">Eddy, W.</span>, <span class="refTitle">"TCP SYN Flooding Attacks and Common Mitigations"</span>, <span class="seriesInfo">RFC 4987</span>, <span class="seriesInfo">DOI 10.17487/RFC4987</span>, <time datetime="2007-08" class="refDate">August 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc4987">https://www.rfc-editor.org/rfc/rfc4987</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6020">[RFC6020]</dt>
        <dd>
<span class="refAuthor">Bjorklund, M., Ed.</span>, <span class="refTitle">"YANG - A Data Modeling Language for the Network Configuration Protocol (NETCONF)"</span>, <span class="seriesInfo">RFC 6020</span>, <span class="seriesInfo">DOI 10.17487/RFC6020</span>, <time datetime="2010-10" class="refDate">October 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6020">https://www.rfc-editor.org/rfc/rfc6020</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7696">[RFC7696]</dt>
        <dd>
<span class="refAuthor">Housley, R.</span>, <span class="refTitle">"Guidelines for Cryptographic Algorithm Agility and Selecting Mandatory-to-Implement Algorithms"</span>, <span class="seriesInfo">BCP 201</span>, <span class="seriesInfo">RFC 7696</span>, <span class="seriesInfo">DOI 10.17487/RFC7696</span>, <time datetime="2015-11" class="refDate">November 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7696">https://www.rfc-editor.org/rfc/rfc7696</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8340">[RFC8340]</dt>
        <dd>
<span class="refAuthor">Bjorklund, M.</span> and <span class="refAuthor">L. Berger, Ed.</span>, <span class="refTitle">"YANG Tree Diagrams"</span>, <span class="seriesInfo">BCP 215</span>, <span class="seriesInfo">RFC 8340</span>, <span class="seriesInfo">DOI 10.17487/RFC8340</span>, <time datetime="2018-03" class="refDate">March 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8340">https://www.rfc-editor.org/rfc/rfc8340</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8999">[RFC8999]</dt>
        <dd>
<span class="refAuthor">Thomson, M.</span>, <span class="refTitle">"Version-Independent Properties of QUIC"</span>, <span class="seriesInfo">RFC 8999</span>, <span class="seriesInfo">DOI 10.17487/RFC8999</span>, <time datetime="2021-05" class="refDate">May 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8999">https://www.rfc-editor.org/rfc/rfc8999</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9001">[RFC9001]</dt>
      <dd>
<span class="refAuthor">Thomson, M., Ed.</span> and <span class="refAuthor">S. Turner, Ed.</span>, <span class="refTitle">"Using TLS to Secure QUIC"</span>, <span class="seriesInfo">RFC 9001</span>, <span class="seriesInfo">DOI 10.17487/RFC9001</span>, <time datetime="2021-05" class="refDate">May 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9001">https://www.rfc-editor.org/rfc/rfc9001</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="yang-model">
<section id="appendix-A">
      <h2 id="name-retry-offload-yang-model">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-retry-offload-yang-model" class="section-name selfRef">Retry Offload YANG Model</a>
      </h2>
<p id="appendix-A-1">These YANG models conform to <span>[<a href="#RFC6020" class="cite xref">RFC6020</a>]</span> and express a complete Retry Offload
configuration.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A-2">
<pre>
module ietf-retry-offload {
  yang-version "1.1";
  namespace "urn:ietf:params:xml:ns:yang:ietf-quic-lb";
  prefix "quic-lb";

  import ietf-yang-types {
    prefix yang;
    reference
      "RFC 6991: Common YANG Data Types.";
  }

  import ietf-inet-types {
    prefix inet;
    reference
      "RFC 6991: Common YANG Data Types.";
  }

  organization
    "IETF QUIC Working Group";

  contact
    "WG Web:   &lt;http://datatracker.ietf.org/wg/quic&gt;
     WG List:  &lt;quic@ietf.org&gt;

     Authors: Martin Duke (martin.h.duke at gmail dot com)
              Nick Banks (nibanks at microsoft dot com)
              Christian Huitema (huitema at huitema.net)";

  description
    "This module enables the explicit cooperation of QUIC servers
     with offloads that generate Retry packets on their behalf.

     Copyright (c) 2022 IETF Trust and the persons identified as
     authors of the code.  All rights reserved.

     Redistribution and use in source and binary forms, with or
     without modification, is permitted pursuant to, and subject to
     the license terms contained in, the Simplified BSD License set
     forth in Section 4.c of the IETF Trust's Legal Provisions
     Relating to IETF Documents
     (https://trustee.ietf.org/license-info).

     This version of this YANG module is part of RFC XXXX
     (https://www.rfc-editor.org/info/rfcXXXX); see the RFC itself
     for full legal notices.

     The key words 'MUST', 'MUST NOT', 'REQUIRED', 'SHALL', 'SHALL
     NOT', 'SHOULD', 'SHOULD NOT', 'RECOMMENDED', 'NOT RECOMMENDED',
     'MAY', and 'OPTIONAL' in this document are to be interpreted as
     described in BCP 14 (RFC 2119) (RFC 8174) when, and only when,
     they appear in all capitals, as shown here.";

  revision "2022-02-11" {
    description
      "Initial version";
    reference
      "RFC XXXX, QUIC Retry Offloads";
  }

  container retry-offload-config {
    description
      "Configuration of Retry Offload. If supported-versions is empty,
       there is no Retry Offload. If token-keys is empty, it uses the
       non-shared-state offload. If present, it uses shared-state
       tokens.";

    leaf-list supported-versions {
      type uint32;
      description
        "QUIC versions that the Retry Offload supports. If empty,
         there is no Retry Offload.";
    }

    leaf unsupported-version-default {
      type enumeration {
        enum allow {
          description "Unsupported versions admitted by default";
        }
        enum deny {
          description "Unsupported versions denied by default";
        }
      }
      default allow;
      description
        "Are unsupported versions not in version-exceptions allowed
         or denied?";
    }

    leaf-list version-exceptions {
      type uint32;
      description
        "Exceptions to the default-deny or default-allow rule.";
    }

    list token-keys {
      key "key-sequence-number";
      description
        "list of active keys, for key rotation purposes. Existence
         implies shared-state format";

      leaf key-sequence-number {
        type uint8 {
          range "0..127";
        }
        mandatory true;
        description
          "Identifies the key used to encrypt the token";
        }

      leaf token-key {
        type retry-offload-key;
        mandatory true;
        description
          "16-byte key to encrypt the token";
      }

      leaf token-iv {
        type yang:hex-string {
          length 23;
        }
        mandatory true;
        description
          "8-byte IV to encrypt the token, encoded in 23 bytes";
      }
    }
  }
}
</pre><a href="#appendix-A-2" class="pilcrow">¶</a>
</div>
<div id="tree-diagram">
<section id="appendix-A.1">
        <h3 id="name-tree-diagram">
<a href="#appendix-A.1" class="section-number selfRef">A.1. </a><a href="#name-tree-diagram" class="section-name selfRef">Tree Diagram</a>
        </h3>
<p id="appendix-A.1-1">This summary of the YANG models uses the notation in <span>[<a href="#RFC8340" class="cite xref">RFC8340</a>]</span>.<a href="#appendix-A.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A.1-2">
<pre>
module: retry-offload-config
  +--rw retry-offload-config
     +--rw supported-versions*            uint32
     +--rw unsupported-version-default?   enumeration
     +--rw version-exceptions*            uint32
     +--rw token-keys* [key-sequence-number]
        +--rw key-sequence-number    uint8
        +--rw token-key              quic-lb-key
        +--rw token-iv               yang:hex-string
</pre><a href="#appendix-A.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="shared-state-retry-token-test-vectors">
<section id="appendix-A.2">
        <h3 id="name-shared-state-retry-token-te">
<a href="#appendix-A.2" class="section-number selfRef">A.2. </a><a href="#name-shared-state-retry-token-te" class="section-name selfRef">Shared State Retry Token Test Vectors</a>
        </h3>
<p id="appendix-A.2-1">In this case, the shared-state retry token is issued by Retry Offload, so the
opaque data of shared-state retry token body would be null
(<a href="#shared-state-retry" class="auto internal xref">Section 4</a>).<a href="#appendix-A.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A.2-2">
<pre>
Configuration:
key_seq 0x00
encrypt_key 0x30313233343536373839303132333435
AEAD_IV 0x313233343536373839303132

Shared-State Retry Offload Token Body:
ODCIL 0x12
RSCIL 0x10
port 0x1a0a
original_destination_connection_id 0x0c3817b544ca1c94313bba41757547eec937
retry_source_connection_id 0x0301e770d24b3b13070dd5c2a9264307
timestamp 0x0000000060c7bf4d

Shared-State Retry Offload Token:
unique_token_number 0x59ef316b70575e793e1a8782
key_sequence 0x00
encrypted_shared_state_retry_offload_token_body
0x7d38b274aa4427c7a1557c3fa666945931defc65da387a83855196a7cb73caac1e28e5346fd76868de94f8b62294
AEAD_ICV 0xf91174fdd711543a32d5e959867f9c22

AEAD related parameters:
client_ip_addr 127.0.0.1
client_port 6666
AEAD_nonce 0x68dd025f45616941072ab6b0
AEAD_associated_data 0x7f00000100000000000000000000000059ef316b70575e793e1a878200
</pre><a href="#appendix-A.2-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="mid-handshake">
<section id="appendix-B">
      <h2 id="name-transition-mode-scenarios">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-transition-mode-scenarios" class="section-name selfRef">Transition Mode Scenarios</a>
      </h2>
<p id="appendix-B-1">The logic motivating transition mode behavior involves detailed reasoning about
endpoint behavior during the handshake. This non-normative appendix walks
through the scenarios.<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<p id="appendix-B-2">Dropping Initial packets in the client's second flight can cause performance
problems or deadlocks. In the case where the client and server first flight end
with both sides having handshake keys, there will generally be no impact on
performance. However, if an Initial ACK is critical to progress, as it can be in
the case of multiple-packet TLS messages, Hello Retry Requests, and similar
cases, dropping subsequent Initial ACKs results in deadlock.<a href="#appendix-B-2" class="pilcrow">¶</a></p>
<p id="appendix-B-3">In transition mode, the Retry Offload forwards Initials with no token while also
generating a Retry. This allows handshakes to progress without further incident.<a href="#appendix-B-3" class="pilcrow">¶</a></p>
<div id="handshakes-in-progress">
<section id="appendix-B.1">
        <h3 id="name-handshakes-in-progress">
<a href="#appendix-B.1" class="section-number selfRef">B.1. </a><a href="#name-handshakes-in-progress" class="section-name selfRef">Handshakes in Progress</a>
        </h3>
<p id="appendix-B.1-1">If the client hello was admitted in inactive mode, then the client has already
received a packet from the server. Although subsequent client Initial packets
will trigger a Retry, the client will ignore these packets. Those Initials will
also be processed by the server to continue the handshake.<a href="#appendix-B.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="new-connections">
<section id="appendix-B.2">
        <h3 id="name-new-connections">
<a href="#appendix-B.2" class="section-number selfRef">B.2. </a><a href="#name-new-connections" class="section-name selfRef">New Connections</a>
        </h3>
<p id="appendix-B.2-1">After sending a Client Hello in Initial Packet A, a client will rapidly receive
a Retry Packet from the Offload and attempt to reconnect accordingly with
Initial Packet B.<a href="#appendix-B.2-1" class="pilcrow">¶</a></p>
<p id="appendix-B.2-2">The client will discard any server response to Initial A. If a Retry, it is a
second Retry on the connection. If an Initial, its is encrypted with keys
derived from Initial A, which have already been discarded, and will be a
decryption failure.<a href="#appendix-B.2-2" class="pilcrow">¶</a></p>
<p id="appendix-B.2-3">Initial B's destination connection ID will be new, so the server will process
it as a new connection and proceed normally.<a href="#appendix-B.2-3" class="pilcrow">¶</a></p>
<p id="appendix-B.2-4">Unfortunately, the server connection state initiated by Initial A will remain.
For this reason, this document suggests that servers silently terminate the
older connection. Requiring the address to be validated avoids cases where an
attacker simply replays a client Initial with a new Destination Connection ID
to terminate a valid connection.<a href="#appendix-B.2-4" class="pilcrow">¶</a></p>
<p id="appendix-B.2-5">Note that there are corner cases involving further packet loss that result in
connection timeout. For instance, if the Retry Offload's response to Initial A
is lost, then the connection will proceed based on Initial A. If the Retry
Offload then switches from transition mode to active mode before the client's
second flight arrives, the Retry Offload will drop the Initial packet in that
flight, and the connection might deadlock.<a href="#appendix-B.2-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-C">
      <h2 id="name-acknowledgments">
<a href="#appendix-C" class="section-number selfRef">Appendix C. </a><a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-C-1">Christian Huitema, Ling Tao Nju, and William Zeng Ke all provided useful input
to this document.<a href="#appendix-C-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="change-log">
<section id="appendix-D">
      <h2 id="name-change-log">
<a href="#appendix-D" class="section-number selfRef">Appendix D. </a><a href="#name-change-log" class="section-name selfRef">Change Log</a>
      </h2>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="appendix-D-1.1">
          <p id="appendix-D-1.1.1"><strong>RFC Editor's Note:</strong>  Please remove this section prior to
publication of a final version of this document.<a href="#appendix-D-1.1.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<div id="since-draft-duke-quic-retry-offload-00">
<section id="appendix-D.1">
        <h3 id="name-since-draft-duke-quic-retry">
<a href="#appendix-D.1" class="section-number selfRef">D.1. </a><a href="#name-since-draft-duke-quic-retry" class="section-name selfRef">since draft-duke-quic-retry-offload-00</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.1-1.1">
            <p id="appendix-D.1-1.1.1">Converted to adopted IETF draft<a href="#appendix-D.1-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.1-1.2">
            <p id="appendix-D.1-1.2.1">Cleaner transition from inactive to active mode<a href="#appendix-D.1-1.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="since-draft-ietf-quic-load-balancers-12">
<section id="appendix-D.2">
        <h3 id="name-since-draft-ietf-quic-load-">
<a href="#appendix-D.2" class="section-number selfRef">D.2. </a><a href="#name-since-draft-ietf-quic-load-" class="section-name selfRef">since draft-ietf-quic-load-balancers-12</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.2-1.1">
            <p id="appendix-D.2-1.1.1">Separated from the QUIC-LB draft<a href="#appendix-D.2-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.2-1.2">
            <p id="appendix-D.2-1.2.1">Renamed "Retry Service" to "Retry Offload"<a href="#appendix-D.2-1.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="since-draft-ietf-quic-load-balancers-11">
<section id="appendix-D.3">
        <h3 id="name-since-draft-ietf-quic-load-b">
<a href="#appendix-D.3" class="section-number selfRef">D.3. </a><a href="#name-since-draft-ietf-quic-load-b" class="section-name selfRef">since draft-ietf-quic-load-balancers-11</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.3-1.1">
            <p id="appendix-D.3-1.1.1">Fixed mistakes in test vectors<a href="#appendix-D.3-1.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="since-draft-ietf-quic-load-balancers-10">
<section id="appendix-D.4">
        <h3 id="name-since-draft-ietf-quic-load-ba">
<a href="#appendix-D.4" class="section-number selfRef">D.4. </a><a href="#name-since-draft-ietf-quic-load-ba" class="section-name selfRef">since draft-ietf-quic-load-balancers-10</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.4-1.1">
            <p id="appendix-D.4-1.1.1">Refactored algorithm descriptions; made the 4-pass algorithm easier to
implement<a href="#appendix-D.4-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.4-1.2">
            <p id="appendix-D.4-1.2.1">Revised test vectors<a href="#appendix-D.4-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.4-1.3">
            <p id="appendix-D.4-1.3.1">Split YANG model into a server and middlebox version<a href="#appendix-D.4-1.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="since-draft-ietf-quic-load-balancers-09">
<section id="appendix-D.5">
        <h3 id="name-since-draft-ietf-quic-load-bal">
<a href="#appendix-D.5" class="section-number selfRef">D.5. </a><a href="#name-since-draft-ietf-quic-load-bal" class="section-name selfRef">since draft-ietf-quic-load-balancers-09</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.5-1.1">
            <p id="appendix-D.5-1.1.1">Renamed "Stream Cipher" and "Block Cipher" to "Encrypted Short" and
"Encrypted Long"<a href="#appendix-D.5-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.2">
            <p id="appendix-D.5-1.2.1">Added section on per-connection state<a href="#appendix-D.5-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.3">
            <p id="appendix-D.5-1.3.1">Changed "Encrypted Short" to a 4-pass algorithm.<a href="#appendix-D.5-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.4">
            <p id="appendix-D.5-1.4.1">Recommended a random initial nonce when incrementing.<a href="#appendix-D.5-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.5-1.5">
            <p id="appendix-D.5-1.5.1">Clarified what SNI LBs should do with unknown QUIC versions.<a href="#appendix-D.5-1.5.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="since-draft-ietf-quic-load-balancers-08">
<section id="appendix-D.6">
        <h3 id="name-since-draft-ietf-quic-load-bala">
<a href="#appendix-D.6" class="section-number selfRef">D.6. </a><a href="#name-since-draft-ietf-quic-load-bala" class="section-name selfRef">since draft-ietf-quic-load-balancers-08</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.6-1.1">
            <p id="appendix-D.6-1.1.1">Eliminate Dynamic SID allocation<a href="#appendix-D.6-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.6-1.2">
            <p id="appendix-D.6-1.2.1">Eliminated server use bytes<a href="#appendix-D.6-1.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="since-draft-ietf-quic-load-balancers-07">
<section id="appendix-D.7">
        <h3 id="name-since-draft-ietf-quic-load-balan">
<a href="#appendix-D.7" class="section-number selfRef">D.7. </a><a href="#name-since-draft-ietf-quic-load-balan" class="section-name selfRef">since draft-ietf-quic-load-balancers-07</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.7-1.1">
            <p id="appendix-D.7-1.1.1">Shortened SSCID nonce minimum length to 4 bytes<a href="#appendix-D.7-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.7-1.2">
            <p id="appendix-D.7-1.2.1">Removed RSCID from Retry token body<a href="#appendix-D.7-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.7-1.3">
            <p id="appendix-D.7-1.3.1">Simplified CID formats<a href="#appendix-D.7-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.7-1.4">
            <p id="appendix-D.7-1.4.1">Shrunk size of SID table<a href="#appendix-D.7-1.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="since-draft-ietf-quic-load-balancers-06">
<section id="appendix-D.8">
        <h3 id="name-since-draft-ietf-quic-load-balanc">
<a href="#appendix-D.8" class="section-number selfRef">D.8. </a><a href="#name-since-draft-ietf-quic-load-balanc" class="section-name selfRef">since draft-ietf-quic-load-balancers-06</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.8-1.1">
            <p id="appendix-D.8-1.1.1">Added interoperability with DTLS<a href="#appendix-D.8-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.8-1.2">
            <p id="appendix-D.8-1.2.1">Changed "non-compliant" to "unroutable"<a href="#appendix-D.8-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.8-1.3">
            <p id="appendix-D.8-1.3.1">Changed "arbitrary" algorithm to "fallback"<a href="#appendix-D.8-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.8-1.4">
            <p id="appendix-D.8-1.4.1">Revised security considerations for mistrustful tenants<a href="#appendix-D.8-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.8-1.5">
            <p id="appendix-D.8-1.5.1">Added Retry Offload considerations for non-Initial packets<a href="#appendix-D.8-1.5.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="since-draft-ietf-quic-load-balancers-05">
<section id="appendix-D.9">
        <h3 id="name-since-draft-ietf-quic-load-balance">
<a href="#appendix-D.9" class="section-number selfRef">D.9. </a><a href="#name-since-draft-ietf-quic-load-balance" class="section-name selfRef">since draft-ietf-quic-load-balancers-05</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.9-1.1">
            <p id="appendix-D.9-1.1.1">Added low-config CID for further discussion<a href="#appendix-D.9-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.9-1.2">
            <p id="appendix-D.9-1.2.1">Complete revision of shared-state Retry Token<a href="#appendix-D.9-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.9-1.3">
            <p id="appendix-D.9-1.3.1">Added YANG model<a href="#appendix-D.9-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.9-1.4">
            <p id="appendix-D.9-1.4.1">Updated configuration limits to ensure CID entropy<a href="#appendix-D.9-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.9-1.5">
            <p id="appendix-D.9-1.5.1">Switched to notation from quic-transport<a href="#appendix-D.9-1.5.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="since-draft-ietf-quic-load-balancers-04">
<section id="appendix-D.10">
        <h3 id="name-since-draft-ietf-quic-load-balancer">
<a href="#appendix-D.10" class="section-number selfRef">D.10. </a><a href="#name-since-draft-ietf-quic-load-balancer" class="section-name selfRef">since draft-ietf-quic-load-balancers-04</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.10-1.1">
            <p id="appendix-D.10-1.1.1">Rearranged the shared-state retry token to simplify token processing<a href="#appendix-D.10-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.10-1.2">
            <p id="appendix-D.10-1.2.1">More compact timestamp in shared-state retry token<a href="#appendix-D.10-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.10-1.3">
            <p id="appendix-D.10-1.3.1">Revised server requirements for shared-state retries<a href="#appendix-D.10-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.10-1.4">
            <p id="appendix-D.10-1.4.1">Eliminated zero padding from the test vectors<a href="#appendix-D.10-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.10-1.5">
            <p id="appendix-D.10-1.5.1">Added server use bytes to the test vectors<a href="#appendix-D.10-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.10-1.6">
            <p id="appendix-D.10-1.6.1">Additional compliant DCID criteria<a href="#appendix-D.10-1.6.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="since-draft-ietf-quic-load-balancers-03">
<section id="appendix-D.11">
        <h3 id="name-since-draft-ietf-quic-load-balancer-2">
<a href="#appendix-D.11" class="section-number selfRef">D.11. </a><a href="#name-since-draft-ietf-quic-load-balancer-2" class="section-name selfRef">since-draft-ietf-quic-load-balancers-03</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.11-1.1">
            <p id="appendix-D.11-1.1.1">Improved Config Rotation text<a href="#appendix-D.11-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.11-1.2">
            <p id="appendix-D.11-1.2.1">Added stream cipher test vectors<a href="#appendix-D.11-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.11-1.3">
            <p id="appendix-D.11-1.3.1">Deleted the Obfuscated CID algorithm<a href="#appendix-D.11-1.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="since-draft-ietf-quic-load-balancers-02">
<section id="appendix-D.12">
        <h3 id="name-since-draft-ietf-quic-load-balancer-3">
<a href="#appendix-D.12" class="section-number selfRef">D.12. </a><a href="#name-since-draft-ietf-quic-load-balancer-3" class="section-name selfRef">since-draft-ietf-quic-load-balancers-02</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.12-1.1">
            <p id="appendix-D.12-1.1.1">Replaced stream cipher algorithm with three-pass version<a href="#appendix-D.12-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.12-1.2">
            <p id="appendix-D.12-1.2.1">Updated Retry format to encode info for required TPs<a href="#appendix-D.12-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.12-1.3">
            <p id="appendix-D.12-1.3.1">Added discussion of version invariance<a href="#appendix-D.12-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.12-1.4">
            <p id="appendix-D.12-1.4.1">Cleaned up text about config rotation<a href="#appendix-D.12-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.12-1.5">
            <p id="appendix-D.12-1.5.1">Added Reset Oracle and limited configuration considerations<a href="#appendix-D.12-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.12-1.6">
            <p id="appendix-D.12-1.6.1">Allow dropped long-header packets for known QUIC versions<a href="#appendix-D.12-1.6.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="since-draft-ietf-quic-load-balancers-01">
<section id="appendix-D.13">
        <h3 id="name-since-draft-ietf-quic-load-balancer-4">
<a href="#appendix-D.13" class="section-number selfRef">D.13. </a><a href="#name-since-draft-ietf-quic-load-balancer-4" class="section-name selfRef">since-draft-ietf-quic-load-balancers-01</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.13-1.1">
            <p id="appendix-D.13-1.1.1">Test vectors for load balancer decoding<a href="#appendix-D.13-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.13-1.2">
            <p id="appendix-D.13-1.2.1">Deleted remnants of in-band protocol<a href="#appendix-D.13-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.13-1.3">
            <p id="appendix-D.13-1.3.1">Light edit of Retry Offloads section<a href="#appendix-D.13-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.13-1.4">
            <p id="appendix-D.13-1.4.1">Discussed load balancer chains<a href="#appendix-D.13-1.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="since-draft-ietf-quic-load-balancers-00">
<section id="appendix-D.14">
        <h3 id="name-since-draft-ietf-quic-load-balancer-5">
<a href="#appendix-D.14" class="section-number selfRef">D.14. </a><a href="#name-since-draft-ietf-quic-load-balancer-5" class="section-name selfRef">since-draft-ietf-quic-load-balancers-00</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.14-1.1">
            <p id="appendix-D.14-1.1.1">Removed in-band protocol from the document<a href="#appendix-D.14-1.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="since-draft-duke-quic-load-balancers-06">
<section id="appendix-D.15">
        <h3 id="name-since-draft-duke-quic-load-">
<a href="#appendix-D.15" class="section-number selfRef">D.15. </a><a href="#name-since-draft-duke-quic-load-" class="section-name selfRef">Since draft-duke-quic-load-balancers-06</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.15-1.1">
            <p id="appendix-D.15-1.1.1">Switch to IETF WG draft.<a href="#appendix-D.15-1.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="since-draft-duke-quic-load-balancers-05">
<section id="appendix-D.16">
        <h3 id="name-since-draft-duke-quic-load-b">
<a href="#appendix-D.16" class="section-number selfRef">D.16. </a><a href="#name-since-draft-duke-quic-load-b" class="section-name selfRef">Since draft-duke-quic-load-balancers-05</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.16-1.1">
            <p id="appendix-D.16-1.1.1">Editorial changes<a href="#appendix-D.16-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.16-1.2">
            <p id="appendix-D.16-1.2.1">Made load balancer behavior independent of QUIC version<a href="#appendix-D.16-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.16-1.3">
            <p id="appendix-D.16-1.3.1">Got rid of token in stream cipher encoding, because server might not have it<a href="#appendix-D.16-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.16-1.4">
            <p id="appendix-D.16-1.4.1">Defined "non-compliant DCID" and specified rules for handling them.<a href="#appendix-D.16-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.16-1.5">
            <p id="appendix-D.16-1.5.1">Added psuedocode for config schema<a href="#appendix-D.16-1.5.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="since-draft-duke-quic-load-balancers-04">
<section id="appendix-D.17">
        <h3 id="name-since-draft-duke-quic-load-ba">
<a href="#appendix-D.17" class="section-number selfRef">D.17. </a><a href="#name-since-draft-duke-quic-load-ba" class="section-name selfRef">Since draft-duke-quic-load-balancers-04</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.17-1.1">
            <p id="appendix-D.17-1.1.1">Added standard for Retry Offloads<a href="#appendix-D.17-1.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="since-draft-duke-quic-load-balancers-03">
<section id="appendix-D.18">
        <h3 id="name-since-draft-duke-quic-load-bal">
<a href="#appendix-D.18" class="section-number selfRef">D.18. </a><a href="#name-since-draft-duke-quic-load-bal" class="section-name selfRef">Since draft-duke-quic-load-balancers-03</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.18-1.1">
            <p id="appendix-D.18-1.1.1">Renamed Plaintext CID algorithm as Obfuscated CID<a href="#appendix-D.18-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.18-1.2">
            <p id="appendix-D.18-1.2.1">Added new Plaintext CID algorithm<a href="#appendix-D.18-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.18-1.3">
            <p id="appendix-D.18-1.3.1">Updated to allow 20B CIDs<a href="#appendix-D.18-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.18-1.4">
            <p id="appendix-D.18-1.4.1">Added self-encoding of CID length<a href="#appendix-D.18-1.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="since-draft-duke-quic-load-balancers-02">
<section id="appendix-D.19">
        <h3 id="name-since-draft-duke-quic-load-bala">
<a href="#appendix-D.19" class="section-number selfRef">D.19. </a><a href="#name-since-draft-duke-quic-load-bala" class="section-name selfRef">Since draft-duke-quic-load-balancers-02</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.19-1.1">
            <p id="appendix-D.19-1.1.1">Added Config Rotation<a href="#appendix-D.19-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.19-1.2">
            <p id="appendix-D.19-1.2.1">Added failover mode<a href="#appendix-D.19-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.19-1.3">
            <p id="appendix-D.19-1.3.1">Tweaks to existing CID algorithms<a href="#appendix-D.19-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.19-1.4">
            <p id="appendix-D.19-1.4.1">Added Block Cipher CID algorithm<a href="#appendix-D.19-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.19-1.5">
            <p id="appendix-D.19-1.5.1">Reformatted QUIC-LB packets<a href="#appendix-D.19-1.5.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="since-draft-duke-quic-load-balancers-01">
<section id="appendix-D.20">
        <h3 id="name-since-draft-duke-quic-load-balan">
<a href="#appendix-D.20" class="section-number selfRef">D.20. </a><a href="#name-since-draft-duke-quic-load-balan" class="section-name selfRef">Since draft-duke-quic-load-balancers-01</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.20-1.1">
            <p id="appendix-D.20-1.1.1">Complete rewrite<a href="#appendix-D.20-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.20-1.2">
            <p id="appendix-D.20-1.2.1">Supports multiple security levels<a href="#appendix-D.20-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.20-1.3">
            <p id="appendix-D.20-1.3.1">Lightweight messages<a href="#appendix-D.20-1.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="since-draft-duke-quic-load-balancers-00">
<section id="appendix-D.21">
        <h3 id="name-since-draft-duke-quic-load-balanc">
<a href="#appendix-D.21" class="section-number selfRef">D.21. </a><a href="#name-since-draft-duke-quic-load-balanc" class="section-name selfRef">Since draft-duke-quic-load-balancers-00</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.21-1.1">
            <p id="appendix-D.21-1.1.1">Converted to markdown<a href="#appendix-D.21-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.21-1.2">
            <p id="appendix-D.21-1.2.1">Added variable length connection IDs<a href="#appendix-D.21-1.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-E">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Martin Duke</span></div>
<div dir="auto" class="left"><span class="org">Google</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:martin.h.duke@gmail.com" class="email">martin.h.duke@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Nick Banks</span></div>
<div dir="auto" class="left"><span class="org">Microsoft</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:nibanks@microsoft.com" class="email">nibanks@microsoft.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
